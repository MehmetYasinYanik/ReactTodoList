<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Firt App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="Style.css" type="text/css" rel="stylesheet" />
</head>
<body>
<section class="container vert-offset-top-2">
    <div id="container" class="todoBox col-xs-6 col-xs-offset-3"></div>
</section>
<script type="text/jsx">

    var Todo = React.createClass({

        getInitialState: function(){
            return {
               data: [
                   {"id":"00001","task":"Kod yaz","complete":"false"},
                   {"id":"00002","task":"Yüzünü yıka","complete":"false"},
                   {"id":"00003","task":"React öğren","complete":"false"}
               ]
            };
        },
        generateId : function () {
            return Math.floor(Math.random()*90000) + 10000;
        },
        handleNodeRemoval : function (nodeId) {
            var data = this.state.data;
            data = data.filter(function(e){
               return e.id !== nodeId;
            });
            this.setState({data});
            return;
        },
        handleSubmit: function(task){
            var data = this.state.data;
            var id = this.generateId().toString();
            var complete = "false";
            data = data.concat([{id,task,complete}]);
            this.setState({data});
        },
        handleToggleComplete : function (nodeId) {
            var data = this.state.data;
            for(var i in data){
                if(data[i].id == nodeId){
                    data[i].complete = data[i].complete === "true" ? "false" : "true";
                    break;
                }
            }
            this.setState({data});
            return;

        },
        render: function() {
            return (
                    <div className="well">
                        <h1 className="vert-offset-top-0">Yapılacaklar:</h1>
                        <TodoList data={this.state.data} removeNode={this.handleNodeRemoval} toggleComplete={this.handleToggleComplete} />
                        <TodoForm onSubmit={this.handleSubmit} />
                    </div>
            );
        }
    });

    var TodoList = React.createClass({

        removeNode: function (nodeId) {
            this.props.removeNode(nodeId);
            return;
        },
        toggleComplete : function (nodeId) {
            this.props.toggleComplete(nodeId);
            return;
        },
        render : function(){
            var list = this.props.data.map(function (item) {
                return <TodoItem key={item.id}
                                 nodeId={item.id}
                                 task={item.task}
                                 complete={item.complete}
                                 removeNode={this.removeNode}
                                 toggleComplete={this.toggleComplete} />
            },this);
            return  (<ul className="list-group">
                         {list}
                     </ul> ) ;
        }

    });

    var TodoItem = React.createClass({
        removeNode : function (e) {
            e.preventDefault();
            this.props.removeNode(this.props.nodeId);
            return;
        },
        toggleComplete: function (e) {
            e.preventDefault();
            this.props.toggleComplete(this.props.nodeId);
            return;
        },
        render: function () {
            var classes = 'list-group-item clearfix';
            if (this.props.complete === 'true') {
                classes = classes + ' list-group-item-success';
            }
            return (
                    <li className={classes}>
                        {this.props.task}
                        <div className="pull-right" role="group">
                            <button type="button" className="btn btn-xs btn-success img-circle" onclick={this.toggleComplete} >Yapıldı</button>
                            <button type="button" className="btn btn-xs btn-danger img-circle" onclick={this.removeNode} >Sil</button>
                        </div>
                    </li>
            );
        }
    });

    var TodoForm = React.createClass({
        doSubmit : function (e) {
            e.preventDefault();
            var task = React.findDOMNode(this.refs.task).value.trim();
            if(!task){
                return;
            }
            this.props.onSubmit(task);
            React.findDOMNode(this.refs.task).value = "";
            return;
        },
        render: function() {
            return (
                    <div className="commentForm vert-offset-top-2">
                        <hr />
                        <div className="clearfix">
                            <form className="todoForm form-horizontal" onSubmit={this.doSubmit}>
                                <div className="form-group">
                                    <label htmlFor="task" className="col-md-2 control-label">Task</label>
                                    <div className="col-md-10">
                                        <input type="text" id="task" ref="task" className="form-control" placeholder="Ne planlamak istiyorsun ?" />
                                    </div>
                                </div>
                                <div className="row">
                                    <div className="col-md-10 col-md-offset-2 text-right">
                                        <input type="submit" value="Save" className="btn btn-primary" />
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
            );
        }
    });


    React.render(<Todo />,document.getElementById("container"));

</script>
</body>
</html>
